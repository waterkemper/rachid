<VirtualHost *:80>
    ServerName orachid.com.br
    ServerAlias www.orachid.com.br
    
    # Proxy to frontend Docker container (on port 8080)
    ProxyPreserveHost On
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/
    
    # Request headers
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
    
    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    # Content Security Policy - versão mais permissiva para resolver problemas de login
    # Permite todas as conexões HTTPS/HTTP necessárias para login e serviços externos
    Header always set Content-Security-Policy "default-src 'self' https: http: data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: http:; style-src 'self' 'unsafe-inline' https: http:; img-src 'self' data: https: http: blob:; font-src 'self' data: https: http:; connect-src 'self' https: http: ws: wss:; frame-src 'self' https: http:; form-action 'self' https: http:;"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/orachid-frontend-error.log
    CustomLog ${APACHE_LOG_DIR}/orachid-frontend-access.log combined
</VirtualHost>

# HTTPS Configuration (after SSL certificate setup)
<VirtualHost *:443>
    ServerName orachid.com.br
    ServerAlias www.orachid.com.br
    
    # SSL Configuration (uncomment after setting up SSL with Let's Encrypt)
    # SSLEngine on
    # SSLCertificateFile /etc/letsencrypt/live/orachid.com.br/fullchain.pem
    # SSLCertificateKeyFile /etc/letsencrypt/live/orachid.com.br/privkey.pem
    
    # Disable OCSP stapling to avoid warnings (certificate doesn't have OCSP URI)
    # OCSP stapling is optional and not required for SSL/TLS to work
    SSLStapling off
    
    # Proxy to frontend Docker container
    ProxyPreserveHost On
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/
    
    # Request headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
    
    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    # HSTS - only on HTTPS
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    # Content Security Policy - versão mais permissiva para resolver problemas de login
    # Permite todas as conexões HTTPS/HTTP necessárias para login e serviços externos
    Header always set Content-Security-Policy "default-src 'self' https: http: data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: http:; style-src 'self' 'unsafe-inline' https: http:; img-src 'self' data: https: http: blob:; font-src 'self' data: https: http:; connect-src 'self' https: http: ws: wss:; frame-src 'self' https: http:; form-action 'self' https: http:;"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/orachid-frontend-ssl-error.log
    CustomLog ${APACHE_LOG_DIR}/orachid-frontend-ssl-access.log combined
</VirtualHost>

